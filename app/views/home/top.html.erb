<body>
    <div class="wrapper">
        <div class="text-info text-center mt-4">
            <h1>TOKONATSU</h1>
            <h4>トコナツ</h4>
            <i class="fas fa-fish"></i>
        </div>
        <div class="text-center mt-4">
            <p>ここから一番近い海は・・・？</p>
            <div class="input-group">
                <input type="textbox" class="form-control" id="adress" placeholder="現在地の住所/施設名">
                <span class="input-group-btn">
                    <button type="submit" id="search" class="btn btn-info" onclick="codeAddress()"><i class="fas fa-search"></i></button>
                </span>
            </div>
        </div>
        <div id="information" class="mt-4 border border-info rounded  text-center">
            <h3 id="sea-title" class="bg-info text-white"></h3>
            <div class="container mt-4 mb-4">
                <div class="row">
                    <div class="col-lg-6">
                        <div id="map"></div>
                    </div>
                    <div class="sea-img col-lg-6">
                        <div id="sea-distance" class="sea-distance mt-2 mb-2"><i class="fas fa-map-signs"></i></div>
                        <div id="sea-img"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"></script>
</body>

<script>
let map
let geocoder
let loc = "(35.71045, 139.8107)"

const display = document.getElementById('display')

function initMap(){
    geocoder = new google.maps.Geocoder()

    map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 35.71045, lng:139.8107},
        zoom: 20,
    });

    marker = new google.maps.Marker({
        position:  {lat: 35.71045, lng:139.8107},
        
        map: map
    });
}


function codeAddress(){
    let inputAddress = document.getElementById('address').value;

    geocoder.geocode( { 'address': inputAddress}, function(results, status) {
        if (status == 'OK') {
            loc = results[0].geometry.location
            map.setCenter(loc);
            var marker = new google.maps.Marker({
                map: map,
                position: loc
            });
            display.textContent = "(緯度, 経度):" + loc
        } else {
            alert('該当する結果がありませんでした：' + status);
        }
    });
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.google_map_api_key %>&callback=initMap" async defer></script>
<script>
loc = "" + loc
console.log(loc)
console.log(loc.slice(1, loc.length - 1))
</script>
<img src="https://maps.googleapis.com/maps/api/streetview?size=400x400&location=35.71045,139.8107&fov=100&heading=80&pitch=50&key=<%= Rails.application.credentials.google_map_api_key %>" async defer></img>

</div>
